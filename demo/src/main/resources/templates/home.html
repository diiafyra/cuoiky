<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
  <th:block th:replace="~{layouts/main :: layout(
    title=~{::title},
    styles=~{::link[@data-page='style']},
    content=~{::section[@data-page='content']},
    scripts=~{::script[@data-page='script']}, 
    )}">
    <head>
      <title>Moodsic • Home</title>
      <link data-page="style" rel="stylesheet" href="/css/home/index.css"/>
    </head>

    <body>
      <section data-page="content">
        <!-- HERO -->
        <section class="hero container">
          <div class="hero__text">
            <h1>Moodsic — nghe theo cảm xúc</h1>
            <p>Viết vài dòng hoặc “vẽ” mood của bạn. Chúng tôi sẽ pha chế playlist vừa khít cảm xúc.</p>
            <div class="hero__cta">
              <button class="btn btn-primary" data-open-mood>Thử ngay</button>
            </div>
          </div>
          <div class="hero__art card">
            <div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div>
          </div>
        </section>

        <!-- PERSONAL -->
        <section class="container section" th:if="${personal != null and personal.size() > 0}">
          <header class="section__head">
            <div>
              <h2>Playlist dành riêng cho bạn</h2>
              <small class="muted">Dựa trên cảm xúc &amp; sở thích đã lưu</small>
            </div>
          </header>

          <div id="personalCarousel" class="carousel">
            <div class="card card--h" th:each="p : ${personal}">
              <img th:src="${p.coverUrl}" th:alt="${p.title}" />
              <div class="card__meta">
                <h3 th:text="${p.title}">Playlist title</h3>
                <small class="muted" th:text="${p.ownerName}">Owner</small>
                <small class="muted" th:if="${p.totalTracks != null}" th:text="${p.totalTracks} + ' tracks'"></small>
              </div>

              <!-- Nút tim -->
              <button class="heart-btn"
                      th:if="${isAuthenticated}"
                      th:attr="data-external-id=${p.externalId},
                               data-title=${p.title},
                               data-external-url=${p.externalUrl},
                               data-cover-url=${p.coverUrl},
                               data-owner-name=${p.ownerName},
                               data-total-tracks=${p.totalTracks},
                               data-snapshot-id=${p.snapshotId}"
                      aria-pressed="false" aria-label="Thích playlist này" title="Thích playlist">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path class="heart-outline" d="M12.1 8.64l-.1.1-.11-.11C10.14 6.87 7.1 7.3 5.6 9.28c-1.23 1.63-1.05 3.92.43 5.35L12 20l5.97-5.37c1.48-1.43 1.66-3.72.43-5.35-1.5-1.98-4.54-2.41-6.3-.64z"
                        fill="none" stroke="currentColor" stroke-width="1.8" />
                  <path class="heart-fill" d="M12 21l-1.45-1.32C5.4 14.36 2 11.28 2 7.5 2 5.01 4.01 3 6.5 3c1.74 0 3.41.81 4.5 2.09C12.59 3.81 14.26 3 16 3 18.49 3 20.5 5.01 20.5 7.5c0 3.78-3.4 6.86-8.05 12.18L12 21z"
                        fill="currentColor"/>
                </svg>
              </button>

              <button class="open-spotify" th:attr="data-url=${p.externalUrl}" aria-label="Mở trên Spotify" title="Mở trên Spotify">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M7 7h10v10M17 7L7 17" fill="none" stroke="currentColor" stroke-width="2" />
                </svg>
              </button>
            </div>
          </div>
        </section>

        <!-- EXPLORE -->
        <section class="container section explore" th:if="${explore != null and explore.size() > 0}">
          <header class="section__head" style="justify-content: space-between; width: 100%">
            <div>
              <h2>Khám phá</h2>
              <small class="muted">Chủ đề được yêu thích</small>
            </div>
          </header>

          <div id="exploreGrid" class="explore-grid">
            <div class="card tile" th:each="p,iter : ${explore}" th:classappend="${iter.index == 0} ? ' tile--featured'">
              <img th:src="${p.coverUrl}" th:alt="${p.title}" />
              <div class="card__meta">
                <h3 th:text="${p.title}">Playlist title</h3>
                <small class="muted" th:text="${p.ownerName}">Owner</small>
              </div>

              <!-- Nút tim -->
              <button class="heart-btn"
                      th:if="${isAuthenticated}"
                      th:attr="data-external-id=${p.externalId},
                               data-title=${p.title},
                               data-external-url=${p.externalUrl},
                               data-cover-url=${p.coverUrl},
                               data-owner-name=${p.ownerName},
                               data-total-tracks=${p.totalTracks},
                               data-snapshot-id=${p.snapshotId}"
                      aria-pressed="false" aria-label="Thích playlist này" title="Thích playlist">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path class="heart-outline" d="M12.1 8.64l-.1.1-.11-.11C10.14 6.87 7.1 7.3 5.6 9.28c-1.23 1.63-1.05 3.92.43 5.35L12 20l5.97-5.37c1.48-1.43 1.66-3.72.43-5.35-1.5-1.98-4.54-2.41-6.3-.64z"
                        fill="none" stroke="currentColor" stroke-width="1.8" />
                  <path class="heart-fill" d="M12 21l-1.45-1.32C5.4 14.36 2 11.28 2 7.5 2 5.01 4.01 3 6.5 3c1.74 0 3.41.81 4.5 2.09C12.59 3.81 14.26 3 16 3 18.49 3 20.5 5.01 20.5 7.5c0 3.78-3.4 6.86-8.05 12.18L12 21z"
                        fill="currentColor"/>
                </svg>
              </button>

              <button class="open-spotify" th:attr="data-url=${p.externalUrl}" aria-label="Mở trên Spotify" title="Mở trên Spotify">
                <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M7 7h10v10M17 7L7 17" fill="none" stroke="currentColor" stroke-width="2" />
                </svg>
              </button>
            </div>
          </div>

          <button id="exploreMore" class="btn btn-outline see-more" style="display: none">Xem thêm</button>
        </section>

        <!-- ABOUT -->
        <section class="about container section">
          <div class="about__grid">
            <div>
              <h3>Về Moodsic</h3>
              <p>Moodsic là công cụ gợi ý âm nhạc theo <b>valence</b> & <b>arousal</b>…</p>
              <ul class="about__bullets">
                <li>Gợi ý theo mood tức thời</li>
                <li>Lưu lịch sử & hình canvas cảm xúc</li>
                <li>Liên kết Spotify để đề xuất chính xác hơn</li>
              </ul>
            </div>
            <div class="about__panel">
              <h4>Liên hệ</h4>
              <p class="muted">Cần tích hợp API, hợp tác, hay góp ý?</p>
              <div class="contact">
                <a href="mailto:hello@moodsic.app" class="btn btn-outline">hello@moodsic.app</a>
                <a href="/contact" class="btn btn-primary">Gửi yêu cầu</a>
              </div>
            </div>
          </div>
        </section>
      </section>

      <script data-page="script" type="module" src="/js/home/index.js"></script>
      <script data-page="script" type="module" src="/js/home/likes.js"></script>
    </body>
  </th:block>
</html>
